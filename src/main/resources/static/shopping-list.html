<!DOCTYPE html>
<html lang="zh-TW" xmlns:x-on="http://www.w3.org/1999/xhtml" xmlns:x-bind="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>冰寶 - 您的冰箱智慧助手</title>
    <meta property="og:title" content="冰寶 - 您的冰箱智慧助手">
    <meta property="og:description" content="「冰寶」是一款智慧冰箱管理助手，專為食品管理而設計。幫助您輕鬆追蹤冰箱內的食材，提供有效的存放建議，並提醒您即將過期的食品。利用AI掃描技術，讓您的食材快速建檔，放進冰箱。冰寶都是提升食品管理的理想夥伴。">
    <meta property="og:image" content="images/favicon.ico">
    <meta property="og:url" content="https://www.gurula.cc/bingBao/dashboard.html">
    <meta property="og:type" content="website">
    <meta content='width=device-width, initial-scale=1.0, shrink-to-fit=no' name='viewport' />
    <link rel="icon" href="images/favicon.ico" type="image/x-icon"/>

    <style>
		.image-container {
            position: relative;
			overflow: hidden;
			background-color: #fff;
		}

		.overlay {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			display: flex;
			justify-content: center;
			align-items: center;
			width: 100%;
			height: 100%;
			opacity: 0;
			transition: opacity 0.3s ease;
		}

		.image-container:hover .overlay {
			opacity: 1;
		}


        .description-container {
            position: relative;
            max-height: 3em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .description-container.expanded {
            max-height: none;
            white-space: normal;
        }

        .expand-button {
            display: none;
            cursor: pointer;
            color: blue;
            text-decoration: underline;
        }

        .description-container.expanded + .expand-button {
            display: block;
        }
        .selected {
            background-color: #31ce36;  /* Bootstrap primary color */
            color: white;
        }
	    .nav-link.error-style {
			border: 2px solid red; /* 红色邊框 */
			background-color: white; /* 白色背景 */
			color: black; /* 黑色文字 */
		}
    </style>

    <!-- Fonts and icons -->
    <script src="js/webfont.min.js"></script>
    <script>
		WebFont.load({
			google: {"families":["Public Sans:300,400,500,600,700"]},
			custom: {"families":["Font Awesome 5 Solid", "Font Awesome 5 Regular", "Font Awesome 5 Brands", "simple-line-icons"], urls: ['css/fonts.min.css']},
			active: function() {
				sessionStorage.fonts = true;
			}
		});
	</script>
    <script src="js/deviceType.js"></script>

    <!-- CSS Files -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/plugins.min.css">
    <link rel="stylesheet" href="css/kaiadmin.min.css">

    <!-- CSS Just for demo purpose, don't include it in your project -->
    <!--	<link rel="stylesheet" href="css/demo.css">-->
</head>
<body x-data="loadData()" x-init="init()">
<div class="wrapper">
    <!-- Sidebar -->
    <div class="sidebar" data-background-color="dark">
        <div class="sidebar-logo">
            <!-- Logo Header -->
            <div class="logo-header" data-background-color="dark">

                <a href="dashboard.html" class="logo">
                    <img src="images/fridge001.jpg" alt="navbar brand" class="navbar-brand" height="20">
                </a>
                <div class="nav-toggle">
                    <button class="btn btn-toggle toggle-sidebar">
                        <i class="gg-menu-right"></i>
                    </button>
                    <button class="btn btn-toggle sidenav-toggler">
                        <i class="gg-menu-left"></i>
                    </button>
                </div>
                <button class="topbar-toggler more">
                    <i class="gg-more-vertical-alt"></i>
                </button>
            </div>
            <!-- End Logo Header -->
        </div>
        <div class="sidebar-wrapper scrollbar scrollbar-inner">
            <div class="sidebar-content">
                <ul class="nav nav-secondary">
                    <li class="nav-section">
							<span class="sidebar-mini-icon">
								<i class="fa fa-ellipsis-h"></i>
							</span>
                        <h4 class="text-section">清單</h4>
                    </li>
                    <li class="nav-item">
                        <a href="dashboard.html">
                            <i class="fas fa-desktop"></i>
                            <p>冰箱清單</p>
                            <span class="badge badge-primary" x-text="todayListLabel"></span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="product.html">
                            <i class="fas fa-fish"></i>
                            <p>食材模板</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="shopping-list.html">
                            <i class="fas fa-shopping-basket"></i>
                            <p>回購清單</p>
                            <span class="badge badge-secondary" x-text="shoppingListLabel"></span>
                        </a>
                    </li>
                    <li class="nav-section">
							<span class="sidebar-mini-icon">
								<i class="fa fa-ellipsis-h"></i>
							</span>
                        <h4 class="text-section">動作</h4>
                    </li>
                    <li class="nav-item submenu">
                        <a data-bs-toggle="collapse" href="#submenu" class="" aria-expanded="true">
                            <i class="fas fa-bars"></i>
                            <p>食材建檔</p>
                            <span class="caret"></span>
                        </a>
                        <div class="collapse show" id="submenu" style="">
                            <ul class="nav nav-collapse">
                                <li class="submenu">
                                    <a href="import.html">
                                        <span class="sub-item">AI建檔</span>
                                    </a>
                                    <a href="add.html">
                                        <span class="sub-item">手動輸入</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a href="receive.html">
                            <i class="fas fa-box-open"></i>
                            <p>食材放進冰箱</p>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!-- End Sidebar -->

    <div class="main-panel">
        <div class="main-header">
            <div class="main-header-logo">
                <!-- Logo Header -->
                <div class="logo-header" data-background-color="dark">

                    <a href="dashboard.html" class="logo">
                        <img src="images/fridge001.jpg" alt="navbar brand" class="navbar-brand" height="20">
                    </a>
                    <div class="nav-toggle">
                        <button class="btn btn-toggle toggle-sidebar">
                            <i class="gg-menu-right"></i>
                        </button>
                        <button class="btn btn-toggle sidenav-toggler">
                            <i class="gg-menu-left"></i>
                        </button>
                    </div>
                    <button class="topbar-toggler more">
                        <i class="gg-more-vertical-alt"></i>
                    </button>

                </div>
                <!-- End Logo Header -->
            </div>
            <!-- Navbar Header -->
            <nav hidden="hidden" class="navbar navbar-header navbar-header-transparent navbar-expand-lg border-bottom"></nav>
            <!-- End Navbar -->
        </div>

        <div class="container">
            <div class="page-inner">
                <div class="row">
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex align-items-center">
                                <h4 class="card-title">回購清單</h4>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <div id="add-row_wrapper" class="dataTables_wrapper container-fluid dt-bootstrap4">
                                    <div class="row">
                                        <div class="col-sm-12 col-md-6">
                                            <div id="select-product_filter_today" class="mb-3">
                                                <input x-on:keydown.enter="shoppingListSearch()" id="shoppingListKeyword" type="search" class="form-control" placeholder="可搜尋食材名稱、供應商名稱" aria-controls="add-row">
                                            </div>
                                            <div class="d-flex flex-column flex-md-row align-items-start mb-3">
                                                <select class="form-select form-control" x-model="priority" x-on:change="shoppingListSearch()">
                                                    <option value="">請選擇優先級別</option>
                                                    <option value="URGENT">緊急</option>
                                                    <option value="NORMAL">普通</option>
                                                </select>
                                            </div>
                                            <div class="d-flex flex-column flex-md-row align-items-start">
                                                <select class="form-select form-control me-2 mb-2 mb-md-0" x-model="selectedCategory" x-on:change="categoryChange()">
                                                    <option value="">請選擇主分類</option>
                                                    <option value="MEAT">肉品</option>
                                                    <option value="SEAFOOD">海鮮</option>
                                                    <option value="VEGETABLES">青菜</option>
                                                    <option value="FRUITS">水果</option>
                                                    <option value="GRAINS">穀物</option>
                                                    <option value="BEVERAGES">飲料</option>
                                                    <option value="CONDIMENTS">醬料</option>
                                                    <option value="SNACKS">零食</option>
                                                    <option value="BAKERY">烘焙食品</option>
                                                    <option value="MEDICINE">藥品</option>
                                                    <option value="CANNED_FOOD">罐頭食品</option>
                                                    <option value="SPICES">香料</option>
                                                    <option value="OILS">食用油</option>
                                                    <option value="SWEETS">甜品</option>
                                                    <option value="DRIED_FOOD">乾貨</option>
                                                    <option value="HEALTH_FOOD">保健食品</option>
                                                </select>
                                                <template x-if="selectedCategory !== 'MEAT' && selectedCategory !== 'SEAFOOD'">
                                                    <select class="form-select form-control" x-model="selectedSubCategory" disabled x-on:change="shoppingListSearch()">
                                                        <option value="">-</option>
                                                    </select>
                                                </template>
                                                <template x-if="selectedCategory === 'MEAT'">
                                                    <select class="form-select form-control" x-model="selectedSubCategory" x-on:change="shoppingListSearch()">
                                                        <option value="">請選擇副分類</option>
                                                        <option value="BEEF">牛肉</option>
                                                        <option value="PORK">豬肉</option>
                                                        <option value="CHICKEN">雞肉</option>
                                                        <option value="EGG">雞蛋</option>
                                                    </select>
                                                </template>
                                                <template x-if="selectedCategory === 'SEAFOOD'">
                                                    <select class="form-select form-control" x-model="selectedSubCategory" x-on:change="shoppingListSearch()">
                                                        <option value="">請選擇副分類</option>
                                                        <option value="FISH">魚</option>
                                                        <option value="SHRIMP">蝦</option>
                                                    </select>
                                                </template>
                                            </div>
                                        </div>
                                        <div class="col-sm-12 col-md-6 d-flex flex-column align-items-end mt-md-0 mt-2">
                                            <div class="d-flex flex-column align-items-end">
                                                <div class="d-flex align-items-center mb-2">
                                                    <i class="fas fa-edit fs-5"></i>
                                                    <span class="ms-2 text-muted">：變更回購數量</span>
                                                </div>
                                                <div class="d-flex align-items-center mb-2">
                                                    <i class="fas fa-tags fs-5"></i>
                                                    <span class="ms-2 text-muted">：變更優先級別</span>
                                                </div>
                                                <div class="d-flex align-items-center mb-2">
                                                    <i class="far fa-check-circle fs-5"></i>
                                                    <span class="ms-2 text-muted">：是否完成購買</span>
                                                </div>
                                                <div class="d-flex align-items-center mb-2">
                                                    <i class="fas fa-trash-alt fs-5"></i>
                                                    <span class="ms-2 text-muted">：刪除回購食材</span>
                                                </div>
                                                <div class="d-flex align-items-center">
                                                    <span class="ms-2 text-muted">名稱字體加大和粗體表示為「緊急」</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12">
                                            <table id="add-row" class="display table table-striped table-hover dataTable" role="grid" aria-describedby="add-row_info">
                                                <thead>
                                                <tr role="row">
                                                    <th>照片</th>
                                                    <th>名稱</th>
                                                    <th>採購總數</th>
                                                    <th>供應商</th>
                                                    <th>包裝類型</th>
                                                    <th>包裝方式</th>
                                                    <th>食材分類</th>
                                                    <th>建檔日期</th>
                                                    <th>動作</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <template x-for="(item,index) in getData()" :key="index">
                                                    <tr role="row" class="odd">
                                                        <td class="image-container">
                                                            <img
                                                                    :src="item.coverPath"
                                                                    alt="cover image"
                                                                    style="width: 75px; height: 75px; border-radius: 10%; object-fit: cover; transition: background-color 0.3s ease, opacity 0.3s ease;">
                                                            <div class="overlay">
                                                                <i class="fas fa-search-plus text-secondary fa-2x" @click="showImagePreview(item.coverPath)"></i>
                                                            </div>
                                                        </td>
                                                        <td x-show="item.priorityType == 'URGENT'" x-text="item.name" style="font-weight: bold; font-size: 1.2rem;"></td>
                                                        <td x-show="item.priorityType == 'NORMAL'" x-text="item.name"></td>
                                                        <td x-text="item.totalAmount"></td>
                                                        <td x-show="item.supplier != null">
                                                            <span x-text="item.supplierName"></span>
                                                        </td>
                                                        <td x-show="item.supplier == null" class="text-center">
                                                            <span>-</span>
                                                        </td>
                                                        <td x-text="item.packageFormLabel"></td>
                                                        <td x-show="item.packageForm == 'COMPLETE'">
                                                            <span>每</span>
                                                            <span class="fw-bold" x-text="item.packageUnitLabel"></span>
                                                            <span>有</span>
                                                            <span class="fw-bold" x-text="item.packageQuantity"></span>
                                                            <span>份</span>
                                                        </td>
                                                        <td x-show="item.packageForm == 'BULK'">
                                                            <span>-</span>
                                                        </td>
                                                        <td x-show="item.mainCategory == 'MEAT' || item.mainCategory == 'SEAFOOD'">
                                                            <span x-text="item.mainCategoryLabel"></span>
                                                            <br>
                                                            <template x-if="item.subCategoryLabel">
                                                                <span>
                                                                    (<span x-text="item.subCategoryLabel"></span>)
                                                                </span>
                                                            </template>
                                                        </td>
                                                        <td x-show="item.mainCategory !== 'MEAT' && item.mainCategory !== 'SEAFOOD'">
                                                            <span x-text="item.mainCategoryLabel"></span>
                                                        </td>
                                                        <td x-text="item.creationDate"></td>
                                                        <td>
                                                            <div class="form-button-action d-flex gap-2 flex-wrap">
                                                                <button @click="openEditModal(item.id, item.totalAmount, item.purchaseQuantity, item.packageForm, item.packageQuantity, item.packageUnitLabel)" type="button" data-bs-toggle="tooltip" title="變更回購數量" class="btn btn-link btn-primary">
                                                                    <i class="fas fa-edit fs-4"></i>
                                                                </button>
                                                                <button @click="openPriorityModal(item.id, item.priorityType, item.name)" type="button" data-bs-toggle="tooltip" title="變更優先級別" class="btn btn-link btn-warning">
                                                                    <i class="fas fa-tags fs-4"></i>
                                                                </button>
                                                                <button @click="openPurchaseModal(item.id, item.name)" type="button" data-bs-toggle="tooltip" title="是否完成購買" class="btn btn-link btn-success">
                                                                    <i class="far fa-check-circle fs-4"></i>
                                                                </button>
                                                                <button @click="openDeleteModal(item.id)" type="button" data-bs-toggle="tooltip" title="刪除回購食材" class="btn btn-link btn-danger">
                                                                    <i class="fas fa-trash-alt fs-4"></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </template>
                                                </tbody>
                                            </table>
                                            <nav class="mt-5 mb-4" x-show="pageCount() > 1">
                                                <ul class="pagination justify-content-center card-page">
                                                    <li class="page-item" :class="{ 'disabled' : pageNumber==0 }">
                                                        <a
                                                                class="page-link page-prev"
                                                                type="button"
                                                                x-on:click="prevPage();"
                                                                :disabled="pageNumber==0"
                                                        >
                                                            <i class="fa fas fa-chevron-left"></i>
                                                        </a>
                                                    </li>
                                                    <li
                                                            class="page-item disabled"
                                                            :class="{ 'd-none' : pageCount() <= 4 || pageNumber == 0 || ( pageCount() > 4 && pageNumber == pageCount() ) }"
                                                    >
                                                        <a class="page-link">···</a>
                                                    </li>
                                                    <template x-for="(page,index) in pages()" :key="index">
                                                        <li
                                                                class="page-item"
                                                                :class="{ 'active' : index === pageNumber , 'd-none' : pageCount() > 4 && ( (index < pageNumber && pageNumber < pageCount() -4) || (index < pageCount() -4 && pageNumber >= pageCount() -4) || index >= pageNumber+4 ) }"
                                                        >
                                                            <a
                                                                    class="page-link"
                                                                    type="button"
                                                                    x-on:click="viewPage(index);"
                                                                    x-text="index+1"
                                                            ></a>
                                                        </li>
                                                    </template>
                                                    <li
                                                            class="page-item disabled"
                                                            :class="{ 'd-none' : pageCount() <= 4 || pageNumber >= pageCount() -4}"
                                                    >
                                                        <a class="page-link">···</a>
                                                    </li>
                                                    <li
                                                            class="page-item"
                                                            :class="{ 'disabled' : pageNumber >= pageCount() -1 }"
                                                    >
                                                        <a
                                                                class="page-link page-next"
                                                                type="button"
                                                                x-on:click="nextPage();"
                                                                :disabled="pageNumber >= pageCount() -1"
                                                        >
                                                            <i class="fa fas fa-chevron-right"></i>
                                                        </a>
                                                    </li>
                                                </ul>
                                            </nav>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <div class="container-fluid d-flex justify-content-between">
                <nav class="pull-left">
                    <ul class="nav">
                        <li class="nav-item">
                            <a class="nav-link" href="http://www.themekita.com">
                                ThemeKita
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#"> Help </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#"> Licenses </a>
                        </li>
                    </ul>
                </nav>
                <div class="copyright">
                    2024, made with <i class="fa fa-heart heart text-danger"></i> by
                    <a href="http://www.themekita.com">ThemeKita</a>
                </div>
                <div>
                    Distributed by
                    <a target="_blank" href="https://themewagon.com/">ThemeWagon</a>.
                </div>
            </div>
        </footer>
    </div>

</div>

<!--   Core JS Files   -->
<script src="js/jquery-3.7.1.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<!-- jQuery Scrollbar -->
<script src="js/jquery.scrollbar.min.js"></script>
<!-- Moment JS -->
<script src="js/moment.min.js"></script>
<!-- Chart JS -->
<script src="js/chart.min.js"></script>
<!-- jQuery Sparkline -->
<script src="js/jquery.sparkline.min.js"></script>
<!-- Chart Circle -->
<script src="js/circles.min.js"></script>
<!-- Datatables -->
<script src="js/datatables.min.js"></script>
<!-- Bootstrap Notify -->
<script src="js/bootstrap-notify.min.js"></script>
<!-- jQuery Vector Maps -->
<script src="js/jsvectormap.min.js"></script>
<script src="js/world.js"></script>
<!-- Sweet Alert -->
<script src="js/sweetalert.min.js"></script>
<!-- Kaiadmin JS -->
<script src="js/kaiadmin.min.js"></script>
<script src="js/alpine.2.8.2.min.js"></script>
<script>

		function loadData() {
			return {
				pageNumber: 0,
				size: 10,
				total: "",
				hasImage: false,
				imageSrc: '',
				shoppingList: [],
				todayListLabel: [],
				shoppingListLabel: [],
				targetDeleteId: "",
				targetEditId: "",
                selectedCategory: "",
				selectedSubCategory: "",
				priority: "",
				packageUnitMap: {
					"EACH": "個",
					"BOX": "箱",
					"PACK": "包",
					"BOTTLE": "瓶",
					"BAG": "袋",
					"BARREL": "桶",
					"CASE": "盒",
					"CAN": "罐",
					"BUNDLE": "捆",
					"STRIP": "條",
					"PORTION": "份"
				},

				init(){
					let _this = this;
				    $.ajax({
						url: "shoppingItemSearch",
						type: "post",
						data: JSON.stringify({'keyword': ''}),
						contentType: "application/json; charset=utf-8",
						success: function (response) {
							if (response.code == "C000"){
								_this.shoppingList = response.data;
							}
						},
						error: function(error) {
							Swal.fire({
								title: '系統錯誤，請聯繫管理員！',
								text: '',
								icon: 'error',
								confirmButtonText: '關閉',
								customClass: {
									confirmButton: 'btn btn-danger'
								}
							})
							console.error('Error:', error);
						}
				  	});
				    $.ajax({
						url: "getTodaySize",
						type: "get",
						contentType: "application/json; charset=utf-8",
						success: function (response) {
							if (response.code == "C000"){
								_this.todayListLabel = response.data;
							}
						},
				  	});
                    $.ajax({
						url: "getShoppingListSize",
						type: "get",
						contentType: "application/json; charset=utf-8",
						success: function (response) {
							if (response.code == "C000"){
								_this.shoppingListLabel = response.data;
							}
						},
				  	});
				},
				showImagePreview(imageSrc) {
					Swal.fire({
						title: '圖片預覽',
						html: `<img src="${imageSrc}" alt="lightbox image" style="width: 100%; height: auto; border-radius: 10px;">`,
						icon: '',
						showCloseButton: true,  // 顯示關閉按鈕
						showConfirmButton: false, // 不顯示確認按鈕
					});
				},
				openEditModal(id, totalAmount, purchaseQuantity, packageForm, packageQuantity, packageUnitLabel){
				    let amountText;
				    if (packageForm == 'COMPLETE'){
				        amountText = purchaseQuantity + ' x ' + packageQuantity + packageUnitLabel + ' = ' + totalAmount + packageUnitLabel;
				    } else {
				        amountText = totalAmount + '份';
				    }

				    let _this = this;
                    Swal.fire({
						title: '下方欄位填寫要變更回購的「包裝數量」',
						text: '回購總數量：' + amountText,
						input: 'number',
						inputAttributes: {
							min: 1,          // 最小值
							max: 999,     // 最大值
							step: 1
						},
						showCancelButton: true,
						confirmButtonText: '確認',
						cancelButtonText: '取消',
						customClass: {
							confirmButton: 'btn btn-success',
							cancelButton: 'btn btn-danger'
						},
					}).then((result) => {
						if (result.isConfirmed) {
							let enteredAmount = result.value;
							_this.editPurchaseQuantity(id, enteredAmount);
						}
					});
				},
				openPriorityModal(id, priority, name){
				    let _this = this;
				    let priorityLabel;
				    if (priority == 'URGENT'){
				        priorityLabel = "普通"
				    } else if (priority == 'NORMAL'){
				        priorityLabel = "緊急"
				    }
					Swal.fire({
						title: `是否要把品項：<strong>${name}</strong> 變更為 <strong style="color: red;">${priorityLabel}</strong>`,
						text: '',
						icon: 'info',
						showCancelButton: true,
						confirmButtonText: '確認',
						cancelButtonText: '取消',
						customClass: {
							confirmButton: 'btn btn-success',
							cancelButton: 'btn btn-danger'
						}
					}).then((result) => {
						if (result.isConfirmed) {
							_this.changePriority(id);
						}
					});
				},
				openPurchaseModal(id, name){
                    let _this = this;
					Swal.fire({
						title: '品項：' + name,
						text: '點擊確認後該品項設定成「完成購買」',
						icon: 'warning',
						showCancelButton: true,
						confirmButtonText: '確認',
						cancelButtonText: '取消',
						customClass: {
							confirmButton: 'btn btn-success',
							cancelButton: 'btn btn-danger'
						}
					}).then((result) => {
						if (result.isConfirmed) {
							_this.changePurchase(id);
						}
					});
				},
				openDeleteModal(id){
					let _this = this;
					Swal.fire({
						title: '確認要刪除？',
						text: '點擊確認後該回購品項將被刪除',
						icon: 'warning',
						showCancelButton: true,
						confirmButtonText: '確認',
						cancelButtonText: '取消',
						customClass: {
							confirmButton: 'btn btn-success',
							cancelButton: 'btn btn-danger'
						}
					}).then((result) => {
						if (result.isConfirmed) {
							_this.deleteShoppingItem(id);
						}
					});
				},
				deleteShoppingItem(id){
				    let _this = this;
				    $.ajax({
						url: "deleteShoppingItem/" + id,
						type: "delete",
						contentType: "application/json; charset=utf-8",
						success: function (response) {
							if (response.code == "C000"){
								Swal.fire({
									title: '刪除成功！',
									text: '',
									icon: 'success',
									confirmButtonText: '關閉',
									customClass: {
										confirmButton: 'btn btn-success'
									}
								}).then((result) => {
									if (result.isConfirmed) {
										_this.init();
									}
								});
							} else if (response.code == "C011"){
								Swal.fire({
									title: '食材模板已經使用，不得刪除！',
									text: '',
									icon: 'error',
									confirmButtonText: '關閉',
									customClass: {
										confirmButton: 'btn btn-danger'
									}
								})
							} else {
								Swal.fire({
									title: '錯誤發生，請聯繫管理員！',
									text: '',
									icon: 'error',
									confirmButtonText: '關閉',
									customClass: {
										confirmButton: 'btn btn-danger'
									}
								})
							}
						},
						error: function(error) {
							Swal.fire({
								title: '系統錯誤，請聯繫管理員！',
								text: '',
								icon: 'error',
								confirmButtonText: '關閉',
								customClass: {
									confirmButton: 'btn btn-danger'
								}
							})
							console.error('Error:', error);
						}
				  	});
				},
				editPurchaseQuantity(id, amount){
                    let _this = this;
                    let data = {};
					data.id = id;
					data.amount = amount;
				    $.ajax({
						url: "editPurchaseQuantity",
						type: "post",
						data: JSON.stringify(data),
						contentType: "application/json; charset=utf-8",
						success: function (response) {
							if (response.code == "C000"){
								Swal.fire({
									title: '變更成功！',
									text: '',
									icon: 'success',
									confirmButtonText: '關閉',
									customClass: {
										confirmButton: 'btn btn-success'
									}
								}).then((result) => {
									if (result.isConfirmed) {
										_this.init();
									}
								});
							} else if (response.code == "C012"){
								Swal.fire({
									title: '查無回購項目，請聯繫管理員！',
									text: '',
									icon: 'error',
									confirmButtonText: '關閉',
									customClass: {
										confirmButton: 'btn btn-danger'
									}
								})
							} else {
								Swal.fire({
									title: '錯誤發生，請聯繫管理員！',
									text: '',
									icon: 'error',
									confirmButtonText: '關閉',
									customClass: {
										confirmButton: 'btn btn-danger'
									}
								})
							}
						},
						error: function(error) {
							Swal.fire({
								title: '系統錯誤，請聯繫管理員！',
								text: '',
								icon: 'error',
								confirmButtonText: '關閉',
								customClass: {
									confirmButton: 'btn btn-danger'
								}
							})
							console.error('Error:', error);
						}
				  	});
				},
				changePurchase(id){
				    let _this = this;
				    $.ajax({
						url: "changePurchase/" + id,
						type: "get",
						contentType: "application/json; charset=utf-8",
						success: function (response) {
							if (response.code == "C000"){
								Swal.fire({
									title: '您已回購該品項成功！',
									text: '',
									icon: 'success',
									confirmButtonText: '關閉',
									customClass: {
										confirmButton: 'btn btn-success'
									}
								}).then((result) => {
									if (result.isConfirmed) {
										_this.init();
									}
								});
							} else if (response.code == "C012"){
								Swal.fire({
									title: '查無回購項目，請聯繫管理員！',
									text: '',
									icon: 'error',
									confirmButtonText: '關閉',
									customClass: {
										confirmButton: 'btn btn-danger'
									}
								})
							} else {
								Swal.fire({
									title: '錯誤發生，請聯繫管理員！',
									text: '',
									icon: 'error',
									confirmButtonText: '關閉',
									customClass: {
										confirmButton: 'btn btn-danger'
									}
								})
							}
						},
						error: function(error) {
							Swal.fire({
								title: '系統錯誤，請聯繫管理員！',
								text: '',
								icon: 'error',
								confirmButtonText: '關閉',
								customClass: {
									confirmButton: 'btn btn-danger'
								}
							})
							console.error('Error:', error);
						}
				  	});
				},
				changePriority(id){
                    let _this = this;
				    $.ajax({
						url: "changePriority/" + id,
						type: "get",
						contentType: "application/json; charset=utf-8",
						success: function (response) {
							if (response.code == "C000"){
								Swal.fire({
									title: '優先級別變更成功！',
									text: '',
									icon: 'success',
									confirmButtonText: '關閉',
									customClass: {
										confirmButton: 'btn btn-success'
									}
								}).then((result) => {
									if (result.isConfirmed) {
										_this.init();
									}
								});
							} else if (response.code == "C012"){
								Swal.fire({
									title: '查無回購項目，請聯繫管理員！',
									text: '',
									icon: 'error',
									confirmButtonText: '關閉',
									customClass: {
										confirmButton: 'btn btn-danger'
									}
								})
							} else {
								Swal.fire({
									title: '錯誤發生，請聯繫管理員！',
									text: '',
									icon: 'error',
									confirmButtonText: '關閉',
									customClass: {
										confirmButton: 'btn btn-danger'
									}
								})
							}
						},
						error: function(error) {
							Swal.fire({
								title: '系統錯誤，請聯繫管理員！',
								text: '',
								icon: 'error',
								confirmButtonText: '關閉',
								customClass: {
									confirmButton: 'btn btn-danger'
								}
							})
							console.error('Error:', error);
						}
				  	});
				},
                selectImage(event) {
                    const file = event.target.files[0];
                    if (file) {
                        this.multipartFile = file;
                        this.imageSrc = URL.createObjectURL(file);
                        this.hasImage = true;
                    } else {
                        this.imageSrc = '';
                        this.hasImage = false;
                    }
                },
                categoryChange() {
					this.selectedSubCategory = '';
					this.shoppingListSearch();
				},
				shoppingListSearch(){
					let _this = this;
					let data = {};
					data.keyword = $("#shoppingListKeyword").val();
					data.mainCategory = this.selectedCategory;
					data.subCategory = this.selectedSubCategory;
					data.priority = this.priority;

				    $.ajax({
						url: "shoppingItemSearch",
						type: "post",
						data: JSON.stringify(data),
						contentType: "application/json; charset=utf-8",
						success: function (response) {
							if (response.code == "C000"){
								_this.shoppingList = response.data;
							}
						},
						error: function(error) {
							Swal.fire({
								title: '系統錯誤，請聯繫管理員！',
								text: '',
								icon: 'error',
								confirmButtonText: '關閉',
								customClass: {
									confirmButton: 'btn btn-danger'
								}
							})
							console.error('Error:', error);
						}
				  	});
				},
				getData(){
					const start = this.pageNumber * this.size,
						  end = start + this.size;
					this.total = this.shoppingList.length;
					return this.shoppingList.slice(start, end);
				},
				pages() {
					return Array.from({
						length: Math.ceil(this.total / this.size),
					});
				},
				nextPage() { this.pageNumber++;},
				prevPage() { this.pageNumber--;},
				pageCount() { return Math.ceil(this.total / this.size);},
				viewPage(index) { this.pageNumber = index;},
			};
		}

	</script>
</body>
</html>